<!-- pages/generatePaperGrade4/generatePaperGrade4.wxml -->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="title">å››å¹´çº§æ•°å­¦è®¡ç®—ä¸“é¡¹ç»ƒä¹ </view>
    <view class="subtitle">è¥¿å¸ˆç‰ˆå°å­¦æ•°å­¦</view>
  </view>

  <!-- é€‰é¡¹å¡ -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 'config' ? 'active' : ''}}" 
      data-tab="config"
      bindtap="switchTab"
    >
      é…ç½®
    </view>
    <view 
      class="tab-item {{activeTab === 'preview' ? 'active' : ''}}" 
      data-tab="preview"
      bindtap="switchTab"
    >
      é¢„è§ˆ
    </view>
    <view 
      class="tab-item {{activeTab === 'answer' ? 'active' : ''}}" 
      data-tab="answer"
      bindtap="switchTab"
    >
      ç­”æ¡ˆ
    </view>
  </view>

  <!-- é…ç½®é€‰é¡¹å¡ -->
  <view class="tab-content" wx:if="{{activeTab === 'config'}}">
    <view class="config-card">
      <view class="config-title">è¯•å·è®¾ç½®</view>
      
      <!-- è¯•å·æ ‡é¢˜ -->
      <view class="config-group">
        <view class="config-label">è¯•å·æ ‡é¢˜</view>
        <input 
          class="config-input" 
          value="{{paperTitle}}" 
          placeholder="è¯·è¾“å…¥è¯•å·æ ‡é¢˜"
          maxlength="50"
          bindinput="onTitleInput"
        />
      </view>

      <!-- é¢˜ç›®ç±»å‹é…ç½® -->
      <view class="config-section">
        <view class="section-title">é¢˜ç›®ç±»å‹é…ç½®</view>
        
        <!-- åŠ¨æ€ç”Ÿæˆé¢˜ç›®ç±»å‹ -->
        <view class="question-type" wx:for="{{questionConfig}}" wx:key="type" wx:for-item="configItem">
          <view class="type-header">
            <text class="type-name">{{configItem.name}}</text>
            <text class="type-score">æ¯é¢˜{{configItem.score}}åˆ†</text>
          </view>
          <view class="type-control">
            <text class="type-label">é¢˜ç›®æ•°é‡ï¼š</text>
            <input 
              type="number" 
              class="count-input" 
              value="{{configItem.count}}" 
              data-type="{{configItem.type}}"
              min="0"
              max="50"
              bindinput="updateQuestionCount"
            />
          </view>
        </view>
      </view>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="stats">
        <view class="stat-item">
          <text>æ€»é¢˜æ•°ï¼š</text>
          <text class="stat-value">{{totalCount}}</text>
        </view>
        <view class="stat-item">
          <text>æ€»åˆ†ï¼š</text>
          <text class="stat-value">{{totalScore}}åˆ†</text>
        </view>
      </view>
    </view>

    <!-- ç”ŸæˆæŒ‰é’® -->
    <button 
      class="generate-btn {{isGenerating ? 'disabled' : ''}}" 
      type="primary" 
      bindtap="generatePaper"
      disabled="{{isGenerating}}"
    >
      {{isGenerating ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆè¯•å·'}}
    </button>
  </view>

  <!-- é¢„è§ˆé€‰é¡¹å¡ -->
  <view class="tab-content" wx:if="{{activeTab === 'preview'}}">
    <view class="preview-card" wx:if="{{questions.length > 0}}">
      <view class="preview-header">
        <view class="paper-title">{{paperTitle}}</view>
        <view class="paper-info">
          å…±{{questions.length}}é¢˜ â€¢ æ€»åˆ†{{totalScore}}åˆ†
        </view>
      </view>

      <!-- é¢˜ç›®åˆ—è¡¨ -->
      <view class="questions-list">
        <view class="question-item" wx:for="{{questions}}" wx:key="id" wx:for-index="idx">
          <view class="question-content">
            <text class="question-index">{{idx + 1}}.</text>
            
            <!-- åˆ†æ•°é¢˜ç›®ç‰¹æ®Šæ˜¾ç¤º -->
            <view wx:if="{{item.type === 'fraction'}}" class="fraction-question">
              <view class="fraction-display">
                <view class="fraction-num">{{item.num1.numerator}}</view>
                <view class="fraction-line"></view>
                <view class="fraction-den">{{item.num1.denominator}}</view>
              </view>
              <text class="fraction-operator">{{item.operator}}</text>
              <view class="fraction-display">
                <view class="fraction-num">{{item.num2.numerator}}</view>
                <view class="fraction-line"></view>
                <view class="fraction-den">{{item.num2.denominator}}</view>
              </view>
              <text class="question-equals">=</text>
            </view>
            
            <!-- å…¶ä»–é¢˜ç›® -->
            <text wx:else class="question-text">{{item.question}}</text>
            
            <text class="question-score">({{item.score}}åˆ†)</text>
          </view>
          <view class="question-category">{{item.category}}</view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-title">è¿˜æ²¡æœ‰ç”Ÿæˆè¯•å·</view>
      <view class="empty-desc">è¯·å…ˆåˆ‡æ¢åˆ°é…ç½®é¡µé¢ç”Ÿæˆè¯•å·</view>
      <button class="empty-btn" bindtap="switchToConfig">å‰å¾€é…ç½®</button>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons" wx:if="{{questions.length > 0}}">
      <button class="action-btn" bindtap="toggleAnswerInputs">
        {{showAnswerInputs ? 'éšè—ç­”æ¡ˆè¾“å…¥' : 'æ˜¾ç¤ºç­”æ¡ˆè¾“å…¥'}}
      </button>
      <button class="action-btn primary" bindtap="checkAnswers">
        æ£€æŸ¥ç­”æ¡ˆ
      </button>
    </view>

    <!-- ç­”æ¡ˆè¾“å…¥åŒºåŸŸ -->
    <view class="answer-inputs" wx:if="{{showAnswerInputs && questions.length > 0}}">
      <view class="answer-title">è¯·è¾“å…¥ç­”æ¡ˆï¼š</view>
      <view class="answers-list">
        <view class="answer-item" wx:for="{{questions}}" wx:key="id" wx:for-index="idx">
          <text class="answer-index">{{idx + 1}}.</text>
          <input 
            class="answer-input" 
            placeholder="è¯·è¾“å…¥ç­”æ¡ˆ"
            data-id="{{item.id}}"
            value="{{userAnswers[item.id]}}"
            bindinput="onAnswerInput"
          />
        </view>
      </view>
    </view>
  </view>

  <!-- ç­”æ¡ˆé€‰é¡¹å¡ -->
  <view class="tab-content" wx:if="{{activeTab === 'answer'}}">
    <view class="answer-card" wx:if="{{questions.length > 0}}">
      <!-- å¾—åˆ†æ˜¾ç¤º -->
      <view class="score-display" wx:if="{{showScore}}">
        <view class="score-value">{{score}}åˆ†</view>
        <view class="score-detail">æ­£ç¡®: {{correctCount}}/{{questions.length}}é¢˜</view>
      </view>

      <!-- ç­”æ¡ˆè¯¦æƒ… -->
      <view class="answers-list">
        <view class="answer-detail" wx:for="{{questions}}" wx:key="id" wx:for-index="idx">
          <view class="answer-question">
            <text class="answer-index">{{idx + 1}}.</text>
            
            <!-- åˆ†æ•°é¢˜ç›® -->
            <view wx:if="{{item.type === 'fraction'}}" class="fraction-question">
              <view class="fraction-display">
                <view class="fraction-num">{{item.num1.numerator}}</view>
                <view class="fraction-line"></view>
                <view class="fraction-den">{{item.num1.denominator}}</view>
              </view>
              <text class="fraction-operator">{{item.operator}}</text>
              <view class="fraction-display">
                <view class="fraction-num">{{item.num2.numerator}}</view>
                <view class="fraction-line"></view>
                <view class="fraction-den">{{item.num2.denominator}}</view>
              </view>
              <text class="question-equals">=</text>
            </view>
            
            <!-- å…¶ä»–é¢˜ç›® -->
            <text wx:else class="answer-text">{{item.question}}</text>
          </view>
          <view class="answer-info">
            <view class="user-answer {{item.isCorrect ? 'correct' : 'wrong'}}">
              ä½ çš„ç­”æ¡ˆ: {{item.userAnswer || 'æœªå›ç­”'}}
            </view>
            <view class="correct-answer">
              æ­£ç¡®ç­”æ¡ˆ: {{item.answer}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“Š</view>
      <view class="empty-title">è¿˜æ²¡æœ‰ç­”æ¡ˆè®°å½•</view>
      <view class="empty-desc">è¯·å…ˆç”Ÿæˆè¯•å·å¹¶å¡«å†™ç­”æ¡ˆ</view>
      <button class="empty-btn" bindtap="switchToConfig">ç”Ÿæˆè¯•å·</button>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons" wx:if="{{questions.length > 0}}">
      <button class="action-btn" bindtap="generatePaper">é‡æ–°ç”Ÿæˆ</button>
      <button class="action-btn primary" bindtap="checkAnswers">æ£€æŸ¥ç­”æ¡ˆ</button>
    </view>
  </view>
</view>
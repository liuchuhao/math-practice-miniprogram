<!-- pages/practice/practice.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
  <view class="header">
    <view class="grade-info">
      <!-- å¢åŠ äº†ä¸€ä¸ªå°å¾½ç« ï¼Œæç¤ºè¿™æ˜¯æ’ä½èµ›æ¨¡å¼ -->
      <view class="rank-badge">ğŸ† æ’ä½èµ›</view>
      <text class="grade-name">{{gradeName}} è®¡ç®—ç»ƒä¹ </text>
      <text class="time">ç”¨æ—¶ï¼š{{formattedTime}}</text>
    </view>
    <view class="progress-info">
      <text class="progress">ç¬¬ {{currentQuestion}} é¢˜ / å…± {{totalQuestions}} é¢˜</text>
      <progress 
        class="progress-bar" 
        percent="{{progressPercent}}" 
        stroke-width="12" 
        activeColor="#3498db" 
        backgroundColor="#eee" 
        active
      />
    </view>
    
    <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
    <view class="quick-actions">
      <button class="action-btn keypad-btn" bindtap="toggleKeypad">
        <icon type="{{showKeypad ? 'unfold' : 'folderopen'}}" size="16"></icon>
        {{showKeypad ? 'éšè—é”®ç›˜' : 'æ˜¾ç¤ºé”®ç›˜'}}
      </button>
      <button class="action-btn restart-btn" bindtap="restartPractice">
        <icon type="refresh" size="16"></icon>
        é‡æ–°å¼€å§‹
      </button>
    </view>
  </view>

  <!-- é¢˜ç›®å¡ç‰‡ -->
  <view class="question-card">
    <view class="question-header">
      <text class="question-label">é¢˜ç›® {{currentQuestion}}</text>
      <text class="difficulty">éš¾åº¦ï¼š{{difficulty}}</text>
    </view>
    
    <view class="question-content">
      <text class="question-text">{{question}}</text>
      <text class="equals">=</text>
      
      <!-- è¾“å…¥æ¡†åŒ…è£…å™¨ -->
      <view class="answer-input-wrapper">
        <input 
          class="answer-input" 
          type="text" 
          placeholder="è¾“å…¥ç­”æ¡ˆ" 
          value="{{userAnswer}}"
          bindinput="onInput"
          bindconfirm="submitAnswer"
          focus="{{autoFocus && !showKeypad}}"
          maxlength="10"
          disabled="{{showKeypad}}"
        />
        
        <!-- è‡ªå®šä¹‰æ¸…é™¤æŒ‰é’® -->
        <view 
          class="custom-clear-btn" 
          wx:if="{{userAnswer}}" 
          bindtap="clearInput"
        >
          <text class="clear-text-icon">Ã—</text>
        </view>
      </view>
    </view>
  </view>

 <!-- è®¡ç®—å™¨é”®ç›˜ -->
 <view class="calculator-keypad" wx:if="{{showKeypad}}">
      <view class="key-row">
        <button class="key" data-key="7" bindtap="onKeyTap">7</button>
        <button class="key" data-key="8" bindtap="onKeyTap">8</button>
        <button class="key" data-key="9" bindtap="onKeyTap">9</button>
        <button class="key del" bindtap="onDelete">
          <icon type="delete" size="18"></icon>
        </button>
      </view>
      <view class="key-row">
        <button class="key" data-key="4" bindtap="onKeyTap">4</button>
        <button class="key" data-key="5" bindtap="onKeyTap">5</button>
        <button class="key" data-key="6" bindtap="onKeyTap">6</button>
        <button class="key" data-key="-" bindtap="onKeyTap">-</button>
      </view>
      <view class="key-row">
        <button class="key" data-key="1" bindtap="onKeyTap">1</button>
        <button class="key" data-key="2" bindtap="onKeyTap">2</button>
        <button class="key" data-key="3" bindtap="onKeyTap">3</button>
        <button class="key" data-key="+" bindtap="onKeyTap">+</button>
      </view>
      <view class="key-row">
        <button class="key zero" data-key="0" bindtap="onKeyTap">0</button>
        <button class="key" data-key="." bindtap="onKeyTap">.</button>
        <button class="key clear" bindtap="clearInput">æ¸…ç©º</button>
        <!-- è¿™é‡ŒåŠ¨æ€ä¿®æ”¹æŒ‰é’®æ–‡å­—ï¼Œå¦‚æœæ˜¯æœ€åä¸€é¢˜ï¼Œæç¤ºâ€œä¸Šä¼ â€ -->
        <button class="key submit" bindtap="submitAnswer">
          {{currentQuestion === totalQuestions ? 'å®Œæˆ' : 'ç¡®å®š'}}
        </button>
      </view>
    </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn skip" bindtap="skipQuestion" hover-class="btn-hover">
      <icon type="cancel" size="18" color="#e74c3c"></icon>
      è·³è¿‡æœ¬é¢˜
    </button>
    
    <!-- è¿™é‡Œçš„æŒ‰é’®æ–‡å­—ä¹Ÿåšäº†åŠ¨æ€å¤„ç† -->
    <button class="btn submit" bindtap="submitAnswer" hover-class="btn-hover">
      <icon type="success" size="18" color="white"></icon>
      {{currentQuestion === totalQuestions ? 'å®Œæˆå¹¶ä¸Šä¼ ' : 'æäº¤ç­”æ¡ˆ'}}
    </button>
  </view>

  <!-- å¾—åˆ†æ¿ -->
  <view class="score-board">
    <view class="score-item">
      <text class="score-label">æ­£ç¡®</text>
      <text class="score-value correct">{{correctCount}}</text>
    </view>
    <view class="score-item">
      <text class="score-label">é”™è¯¯</text>
      <text class="score-value wrong">{{wrongCount}}</text>
    </view>
    <view class="score-item">
      <text class="score-label">å¾—åˆ†</text>
      <text class="score-value">{{score}}</text>
    </view>
    <view class="score-item">
      <text class="score-label">æ­£ç¡®ç‡</text>
      <text class="score-value rate">{{correctRate}}%</text>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section" wx:if="{{history.length > 0}}">
    <view class="history-header">
      <text class="history-title">æœ€è¿‘ç­”é¢˜è®°å½•</text>
      <button class="clear-history-btn" bindtap="clearHistory" wx:if="{{history.length > 0}}">
        <icon type="clear" size="14"></icon>
        æ¸…ç©º
      </button>
    </view>
    <view class="history-list">
      <view class="history-item" wx:for="{{history}}" wx:key="index">
        <view class="history-question-section">
          <text class="history-index">{{index + 1}}.</text>
          <text class="history-question">{{item.question}} = </text>
          <text class="history-user-answer {{item.isCorrect ? 'correct' : 'wrong'}}">
            {{item.userAnswer}}
          </text>
        </view>
        <view class="history-result" wx:if="{{!item.isCorrect && item.userAnswer !== 'è·³è¿‡'}}">
          <text class="correct-answer">æ­£ç¡®ç­”æ¡ˆï¼š{{item.correctAnswer}}</text>
        </view>
        <view class="history-time">
          <icon type="waiting" size="12" color="#7f8c8d"></icon>
          <text class="time-text">{{item.time}}</text>
          <text class="skip-tag" wx:if="{{item.skipped}}">[è·³è¿‡]</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æç¤ºä¿¡æ¯ -->
  <view class="hint-section" wx:if="{{currentQuestion === 1 && history.length === 0}}">
    <text class="hint-title">ğŸ’¡ ç«èµ›è§„åˆ™</text>
    <view class="hint-item">
      <icon type="info" size="14" color="#3498db"></icon>
      <text>å…±{{totalQuestions}}é¢˜ï¼Œæ¯é¢˜10åˆ†</text>
    </view>
    <view class="hint-item">
      <icon type="info" size="14" color="#3498db"></icon>
      <text>ç­”é¢˜è¶Šå¿«ï¼Œæ’åè¶Šé«˜</text>
    </view>
    <view class="hint-item">
      <icon type="info" size="14" color="#3498db"></icon>
      <text>æˆç»©å°†è‡ªåŠ¨ä¸Šä¼ è‡³æ’è¡Œæ¦œ</text>
    </view>
  </view>
</view>
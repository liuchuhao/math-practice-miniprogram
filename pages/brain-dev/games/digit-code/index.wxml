<view class="game-container" style="background: linear-gradient(135deg, #0c0c1e 0%, #1a1a3e 50%, #2d2d5a 100%);">
  
  <!-- 顶部状态栏 -->
  <view class="game-header" wx:if="{{gameState === 'memorizing' || gameState === 'answering'}}">
    <view class="header-item">
      <text class="header-label">等级</text>
      <text class="header-value">{{level}}/10</text>
    </view>
    <view class="header-item">
      <text class="header-label">位数</text>
      <text class="header-value">{{digits}}</text>
    </view>
    <view class="header-item">
      <text class="header-label">得分</text>
      <text class="header-value large">{{score}}</text>
    </view>
    <view class="timer-box {{timeWarning ? 'warning' : ''}}">
      <text class="header-value">{{totalTime}}s</text>
    </view>
  </view>

  <!-- 开始界面 -->
  <view class="start-screen" wx:if="{{gameState === 'ready'}}">
    <text class="game-icon">🔢</text>
    <text class="game-title">数字密码</text>
    <text class="game-desc">记住闪现的数字序列，选出正确答案</text>
    <text class="game-tip">答对加分升级，答错扣分降级！</text>
    
    <view class="diff-section">
      <text class="diff-title">选择难度</text>
      <view class="diff-options">
        <view class="diff-btn {{difficulty === 'easy' ? 'active' : ''}}" bindtap="onDiffChange" data-diff="easy">
          <text class="icon">🌟</text>
          <text class="name">简单</text>
        </view>
        <view class="diff-btn {{difficulty === 'medium' ? 'active' : ''}}" bindtap="onDiffChange" data-diff="medium">
          <text class="icon">⭐</text>
          <text class="name">中等</text>
        </view>
        <view class="diff-btn {{difficulty === 'hard' ? 'active' : ''}}" bindtap="onDiffChange" data-diff="hard">
          <text class="icon">💫</text>
          <text class="name">困难</text>
        </view>
      </view>
    </view>
    
    <button class="start-btn" bindtap="onStart">开始游戏</button>
  </view>

  <!-- 倒计时 -->
  <view class="countdown-screen" wx:if="{{gameState === 'countdown'}}">
    <view class="countdown-circle">
      <text class="countdown-num">{{countdown}}</text>
    </view>
    <text class="countdown-hint">准备记忆...</text>
  </view>

  <!-- 记忆阶段 -->
  <view class="memory-screen" wx:if="{{gameState === 'memorizing'}}">
    <view class="phase-hint">
      <text class="hint-icon">👀</text>
      <text class="hint-text">记住这串数字</text>
    </view>
    
    <view class="code-display">
      <view wx:for="{{targetCode}}" wx:key="index" class="code-digit">
        <text>{{item}}</text>
      </view>
    </view>
    
    <view class="memory-bar">
  <!-- 这里直接使用 JS 生成好的 barStyle -->
  <view class="bar-fill" style="{{barStyle}}"></view>
</view>
  </view>

  <!-- 答题阶段 -->
  <view class="answer-screen" wx:if="{{gameState === 'answering'}}">
    <view class="phase-hint">
      <text class="hint-icon">🤔</text>
      <text class="hint-text">选择正确的数字序列</text>
    </view>
    
    <view class="code-options">
      <view 
        wx:for="{{options}}" 
        wx:key="index"
        class="code-option {{selectedIndex === index ? (isCorrect ? 'correct' : 'wrong') : ''}}"
        bindtap="onSelect" 
        data-index="{{index}}">
        <text class="opt-label">{{['A','B','C','D'][index]}}</text>
        <view class="opt-digits">
          <text wx:for="{{item}}" wx:for-item="d" wx:key="*this">{{d}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 反馈提示 -->
  <view class="feedback-toast {{showFeedback ? 'show' : ''}} {{isCorrect ? 'correct' : 'wrong'}}" wx:if="{{showFeedback}}">
    <text class="toast-icon">{{isCorrect ? '✓' : '✗'}}</text>
    <text class="toast-text">{{isCorrect ? '记忆正确！' : '记错了，答案是' + targetCode}}</text>
  </view>

  <!-- 结束界面 -->
  <view class="end-screen" wx:if="{{gameState === 'ended'}}">
    <view class="end-card">
      <text class="end-icon">🏆</text>
      <text class="end-title">时间到！</text>
      
      <view class="score-section">
        <view class="score-row">
          <text class="score-label">游戏得分</text>
          <text class="score-value">{{score}}</text>
        </view>
        <view class="reward-row">
          <text class="reward-label">🎁 奖励积分</text>
          <text class="reward-value">+{{reward}}</text>
        </view>
      </view>
      
      <view class="stats-grid">
        <view class="stat-box">
          <text class="stat-num">{{level}}</text>
          <text class="stat-label">达到等级</text>
        </view>
        <view class="stat-box">
          <text class="stat-num">{{correctCount}}/{{questionCount}}</text>
          <text class="stat-label">正确/总题</text>
        </view>
        <view class="stat-box">
          <text class="stat-num">{{accuracy}}%</text>
          <text class="stat-label">正确率</text>
        </view>
      </view>
      
      <view class="rank-box">
        <text class="rank-emoji">{{rankEmoji}}</text>
        <text class="rank-text">{{rankText}}</text>
      </view>
      
      <view class="btn-group">
        <button class="btn-retry" bindtap="onRetry">再玩一次</button>
        <button class="btn-back" bindtap="onBack">返回</button>
      </view>
    </view>
  </view>
</view>
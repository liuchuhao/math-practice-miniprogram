<!-- pages/generatePaperGrade5/generatePaperGrade5.wxml 简化版 -->
<view class="container">
  <!-- 头部 -->
  <view class="header">
    <view class="title">五年级数学计算专项练习</view>
    <view class="subtitle">西师版小学数学</view>
  </view>

  <!-- 选项卡 -->
  <view class="tabs">
    <view class="tab-item {{activeTab === 'config' ? 'active' : ''}}" data-tab="config" bindtap="switchTab">配置</view>
    <view class="tab-item {{activeTab === 'preview' ? 'active' : ''}}" data-tab="preview" bindtap="switchTab">预览</view>
    <view class="tab-item {{activeTab === 'answer' ? 'active' : ''}}" data-tab="answer" bindtap="switchTab">答案</view>
  </view>

  <!-- 配置页面 -->
  <view wx:if="{{activeTab === 'config'}}">
    <view class="config-card">
      <view class="config-title">试卷设置</view>
      
      <view class="config-group">
        <view class="config-label">试卷标题</view>
        <input class="config-input" value="{{paperTitle}}" placeholder="请输入试卷标题" maxlength="50" bindinput="onTitleInput" />
      </view>

      <view class="config-section">
        <view class="section-title">题目类型配置</view>
        
        <view class="question-type" wx:for="{{questionConfig}}" wx:key="type">
          <view class="type-header">
            <text class="type-name">{{item.name}}</text>
            <text class="type-score">每题{{item.score}}分</text>
          </view>
          <view class="type-control">
            <text class="type-label">题目数量：</text>
            <input type="number" class="count-input" value="{{item.count}}" data-type="{{item.type}}" min="0" max="50" bindinput="updateQuestionCount" />
          </view>
        </view>
      </view>

      <view class="stats">
        <view class="stat-item">
          <text>总题数：</text>
          <text class="stat-value">{{totalCount}}</text>
        </view>
        <view class="stat-item">
          <text>总分：</text>
          <text class="stat-value">{{totalScore}}分</text>
        </view>
      </view>
    </view>

    <button class="generate-btn {{isGenerating ? 'disabled' : ''}}" type="primary" bindtap="generatePaper" disabled="{{isGenerating}}">
      {{isGenerating ? '生成中...' : '生成试卷'}}
    </button>
  </view>

  <!-- 预览页面 -->
  <view wx:if="{{activeTab === 'preview'}}">
    <view wx:if="{{questions.length > 0}}">
      <view class="preview-card">
        <view class="preview-header">
          <view class="paper-title">{{paperTitle}}</view>
          <view class="paper-info">共{{questions.length}}题 • 总分{{totalScore}}分</view>
        </view>

        <view class="questions-list">
          <view class="question-item" wx:for="{{questions}}" wx:key="id" wx:for-index="idx">
            <view class="question-content">
              <text class="question-index">{{idx + 1}}.</text>
              <text class="question-text">{{item.question}}</text>
              <text class="question-score">({{item.score}}分)</text>
            </view>
            <view class="question-category">{{item.category}}</view>
          </view>
        </view>
      </view>

      <view class="action-buttons">
        <button class="action-btn" bindtap="toggleAnswerInputs">
          {{showAnswerInputs ? '隐藏答案输入' : '显示答案输入'}}
        </button>
        <button class="action-btn primary" bindtap="checkAnswers">检查答案</button>
      </view>

      <view wx:if="{{showAnswerInputs}}" class="answer-inputs">
        <view class="answer-title">请输入答案：</view>
        <view class="answers-list">
          <view class="answer-item" wx:for="{{questions}}" wx:key="id" wx:for-index="idx">
            <text class="answer-index">{{idx + 1}}.</text>
            <input class="answer-input" placeholder="请输入答案" data-id="{{item.id}}" value="{{userAnswers[item.id]}}" bindinput="onAnswerInput" />
          </view>
        </view>
      </view>
    </view>

    <view wx:else>
      <view class="empty-state">
        <view class="empty-icon">📝</view>
        <view class="empty-title">还没有生成试卷</view>
        <view class="empty-desc">请先切换到配置页面生成试卷</view>
        <button class="empty-btn" bindtap="switchToConfig">前往配置</button>
      </view>
    </view>
  </view>

  <!-- 答案页面 -->
  <view wx:if="{{activeTab === 'answer'}}">
    <view wx:if="{{questions.length > 0}}">
      <view class="answer-card">
        <view wx:if="{{showScore}}" class="score-display">
          <view class="score-value">{{score}}分</view>
          <view class="score-detail">正确: {{correctCount}}/{{questions.length}}题</view>
        </view>

        <view class="answers-list">
          <view class="answer-detail" wx:for="{{questions}}" wx:key="id" wx:for-index="idx">
            <view class="answer-question">
              <text class="answer-index">{{idx + 1}}.</text>
              <text class="answer-text">{{item.question}}</text>
            </view>
            <view class="answer-info">
              <view class="user-answer {{item.isCorrect ? 'correct' : 'wrong'}}">
                你的答案: {{item.userAnswer || '未回答'}}
              </view>
              <view class="correct-answer">
                正确答案: {{item.answer}}
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="action-buttons">
        <button class="action-btn" bindtap="generatePaper">重新生成</button>
        <button class="action-btn primary" bindtap="checkAnswers">检查答案</button>
      </view>
    </view>

    <view wx:else>
      <view class="empty-state">
        <view class="empty-icon">📊</view>
        <view class="empty-title">还没有答案记录</view>
        <view class="empty-desc">请先生成试卷并填写答案</view>
        <button class="empty-btn" bindtap="switchToConfig">生成试卷</button>
      </view>
    </view>
  </view>
</view>